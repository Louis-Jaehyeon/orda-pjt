<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ë¥´ë‹¤ - ì˜¤ëŠ˜ì˜ ì´ìŠˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        
        .layout {
            display: flex;
            min-height: 100vh;
        }
        
        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 260px;
            background: white;
            border-right: 1px solid #e9ecef;
            padding: 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
        }
        
        .logo-section {
            background: linear-gradient(135deg, #FF6B6B 0%, #FF5252 100%);
            color: white;
            padding: 1.5rem;
            text-align: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .logo-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .nav-menu {
            padding: 1.5rem 0;
        }
        
        .nav-item {
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        
        .nav-item:hover {
            background-color: #f8f9fa;
            border-left-color: #FF6B6B;
        }
        
        .nav-item.active {
            background-color: #fff3f3;
            border-left-color: #FF6B6B;
            color: #FF6B6B;
            font-weight: 600;
        }
        
        .nav-icon {
            font-size: 1.1rem;
            width: 20px;
        }
        
        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }
        
        /* í˜ì´ì§€ í—¤ë” */
        .page-header {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .welcome-text {
            color: #6c757d;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        
        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 1rem;
        }
        
        .page-subtitle {
            color: #6c757d;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .today-date {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            display: inline-block;
            margin-top: 1rem;
            font-weight: 600;
        }
        
        /* ì´ìŠˆ ëª©ë¡ ì„¹ì…˜ */
        .issues-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        

        
        /* ì´ìŠˆ ê·¸ë¦¬ë“œ */
        .issues-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
        }
        
        .issue-card {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: white;
            overflow: hidden;
        }
        
        .issue-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
            border-color: #FF6B6B;
        }
        
        .issue-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #FF6B6B, #667eea, #a8e6cf);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .issue-card:hover::before {
            opacity: 1;
        }
        
        .issue-header {
            display: flex;
            justify-content: flex-end;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .issue-number {
            background: #f8f9fa;
            color: #6c757d;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        

        
        .issue-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
            line-height: 1.4;
            color: #2c3e50;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .issue-content {
            color: #6c757d;
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .issue-footer {
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }
        

        
        .analyze-btn {
            background: linear-gradient(135deg, #FF6B6B 0%, #FF5252 100%);
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .analyze-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
        }
        
        /* ë¡œë”© ìƒíƒœ */
        .loading {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #FF6B6B;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ìƒíƒœ í‘œì‹œ */
        .status-bar {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #495057;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
        }
        
        /* ë°˜ì‘í˜• */
        @media (max-width: 1024px) {
            .issues-grid {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .layout {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                order: 2;
            }
            
            .main-content {
                order: 1;
                padding: 1rem;
            }
            
            .issues-grid {
                grid-template-columns: 1fr;
            }
            
            .page-title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="layout">
        <!-- ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <div class="logo-section">
                <div class="logo">ì˜¤ë¥´ë‹¤</div>
                <div class="logo-subtitle">íˆ¬ì í•™ìŠµ í”Œë«í¼</div>
            </div>
            <div class="nav-menu">
                <div class="nav-item active" onclick="navigateTo('home')">
                    <span class="nav-icon">ğŸ </span>
                    <span>Home</span>
                </div>
                <div class="nav-item" onclick="navigateTo('news')">
                    <span class="nav-icon">ğŸ“°</span>
                    <span>News</span>
                </div>
                <div class="nav-item" onclick="navigateTo('sector')">
                    <span class="nav-icon">ğŸ­</span>
                    <span>Sector</span>
                </div>
                <div class="nav-item" onclick="navigateTo('company')">
                    <span class="nav-icon">ğŸ¢</span>
                    <span>Company</span>
                </div>
                <div class="nav-item" onclick="navigateTo('mock-invest')">
                    <span class="nav-icon">ğŸ“ˆ</span>
                    <span>Mock Invest</span>
                </div>
            </div>
        </div>
        
        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <div class="main-content">
            <!-- í˜ì´ì§€ í—¤ë” -->
            <div class="page-header">
                <div class="welcome-text">íˆ¬ì í•™ìŠµì˜ ì‹œì‘</div>
                <h1 class="page-title">ì˜¤ëŠ˜ì˜ ì´ìŠˆ</h1>
                <p class="page-subtitle">
                    ì˜¤ëŠ˜ ì£¼ëª©í•  ë§Œí•œ ì´ìŠˆë“¤ì„ ì„ íƒí•˜ì—¬<br>
                    ê³¼ê±° ìœ ì‚¬ ì‚¬ë¡€ì™€ íˆ¬ì íŒ¨í„´ì„ í•™ìŠµí•´ë³´ì„¸ìš”
                </p>
                <div class="today-date" id="today-date">
                    2025ë…„ 7ì›” 18ì¼ ê¸ˆìš”ì¼
                </div>
            </div>
            
            <!-- ìƒíƒœ í‘œì‹œ -->
            <div class="status-bar">
                <div class="status-info">
                    <div class="status-item">
                        <div class="status-indicator"></div>
                        <span>BigKinds ì—°ê²°ë¨</span>
                    </div>
                    <div class="status-item">
                        <span>ğŸ“… ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 09:30</span>
                    </div>
                    <div class="status-item">
                        <span>ğŸ“Š ì´ 10ê°œ ì´ìŠˆ</span>
                    </div>
                </div>
            </div>
            
            <!-- ì´ìŠˆ ëª©ë¡ -->
            <div class="issues-section">
                <div class="section-header">
                    <h2 class="section-title">
                        ğŸ“° ì˜¤ëŠ˜ì˜ ì£¼ìš” ì´ìŠˆ (10ê°œ)
                    </h2>
                </div>
                
                <div class="issues-grid" id="issues-grid">
                    <!-- ë¡œë”© ìƒíƒœ -->
                    <div class="loading" id="loading-state">
                        <div class="spinner"></div>
                        <p>ì˜¤ëŠ˜ì˜ ì´ìŠˆë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- index.htmlì˜ JavaScript ë¶€ë¶„ì„ ìˆ˜ì • - BigKinds í¬ë¡¤ë§ ë°ì´í„° ì—°ë™ -->

    <script>
        // ì‹¤ì œ BigKinds í¬ë¡¤ë§ ë°ì´í„°ë¥¼ ì €ì¥í•  ë³€ìˆ˜
        let currentIssues = [];
        let isRefreshing = false;
        
        // ë”ë¯¸ ì´ìŠˆ ë°ì´í„° (API ì‹¤íŒ¨ ì‹œ í´ë°±ìš©)
        const dummyIssues = [
            {
                ì´ìŠˆë²ˆí˜¸: 1,
                ì œëª©: "íŠ¸ëŸ¼í”„, ì¹´íƒ€ë¥´ ê³µê²© ì´í›„ ì´ë€ì˜ ë¯¸í˜¼ì¬ ëŒ€ì‘ì— ê°ì‚¬ í‘œëª…",
                ë‚´ìš©: "íŠ¸ëŸ¼í”„ ëŒ€í†µë ¹ì´ ì´ë€ê³¼ì˜ ê°ˆë“± ìƒí™©ì—ì„œ ì¹´íƒ€ë¥´ì˜ ì¤‘ì¬ ë…¸ë ¥ì— ê°ì‚¬ë¥¼ í‘œëª…í•˜ë©°, ì¤‘ë™ ì§€ì—­ì˜ ì•ˆì •í™”ë¥¼ ìœ„í•œ ì™¸êµì  í•´ê²°ì±…ì„ ëª¨ìƒ‰í•˜ê³  ìˆë‹¤ê³  ë°í˜”ë‹¤.",
                ì¶”ì¶œì‹œê°„: new Date().toISOString()
            },
            {
                ì´ìŠˆë²ˆí˜¸: 2,
                ì œëª©: "ë‚˜ë…¸ì—  ëŒ€í‘œíŒ€, ì±„ì›Œì§„ ì§€ì—­ ë‹¹í˜¹ ê°ê²½ ë° ë¯¼êµ­ ì˜ê° í‘œí–¥",
                ë‚´ìš©: "ë‚˜ë…¸ê¸°ìˆ  ê´€ë ¨ ê¸°ì—…ë“¤ì˜ ëŒ€í‘œíŒ€ì´ ì§€ì—­ë³„ ê¸°ìˆ ê²©ì°¨ í•´ì†Œë¥¼ ìœ„í•œ ìƒˆë¡œìš´ ì •ì±… ë°©ì•ˆì„ ë°œí‘œí–ˆë‹¤.",
                ì¶”ì¶œì‹œê°„: new Date().toISOString()
            },
            {
                ì´ìŠˆë²ˆí˜¸: 3,
                ì œëª©: "ì´ì¬ëª… ìƒëª© í™œì • ì§‘ë§˜ê² ê¶ì„œ ë¬´ì‹¤ í™˜ê²½",
                ë‚´ìš©: "ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹ ì´ì¬ëª… ëŒ€í‘œê°€ ìƒëª© ì§€ì—­ í™˜ê²½ì •ì±…ì— ëŒ€í•œ ìƒˆë¡œìš´ ë°©í–¥ì„ ì œì‹œí–ˆë‹¤.",
                ì¶”ì¶œì‹œê°„: new Date().toISOString()
            }
        ];

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            updateTodayDate();
            loadCurrentIssues();
            setupRefreshButton();
        });

        // ì˜¤ëŠ˜ ë‚ ì§œ ì—…ë°ì´íŠ¸
        function updateTodayDate() {
            const today = new Date();
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            };
            const dateString = today.toLocaleDateString('ko-KR', options);
            const timeString = today.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
            
            document.getElementById('today-date').textContent = `${dateString} ${timeString}`;
        }

        // BigKinds APIì—ì„œ í˜„ì¬ ì´ìŠˆ ë¡œë“œ
        async function loadCurrentIssues() {
            const grid = document.getElementById('issues-grid');
            const loading = document.getElementById('loading-state');
            
            console.log('ğŸ”„ BigKinds APIì—ì„œ í˜„ì¬ ì´ìŠˆ ë¡œë”© ì¤‘...');
            
            try {
                // ë¡œë”© ìƒíƒœ í‘œì‹œ
                if (loading) {
                    loading.style.display = 'block';
                    loading.innerHTML = `
                        <div style="text-align: center; padding: 2rem;">
                            <div style="border: 4px solid #f3f3f3; border-top: 4px solid #FF6B6B; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                            <p>ğŸ” BigKindsì—ì„œ ìµœì‹  ì´ìŠˆë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</p>
                            <small style="color: #666;">í¬ë¡¤ë§ëœ ë°ì´í„° ë˜ëŠ” ì‹¤ì‹œê°„ í¬ë¡¤ë§ ì§„í–‰</small>
                        </div>
                    `;
                }
                
                // ì‹¤ì œ BigKinds API í˜¸ì¶œ
                const response = await fetch('/api/today-issues');
                console.log('ğŸ“¡ Today Issues API ì‘ë‹µ ìƒíƒœ:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('ğŸ“Š Today Issues API ì‘ë‹µ ë°ì´í„°:', result);
                
                if (result.success && result.data && Array.isArray(result.data)) {
                    // API ë°ì´í„°ë¥¼ í™”ë©´ í‘œì‹œ í˜•íƒœë¡œ ë³€í™˜
                    currentIssues = result.data.map((issue, index) => ({
                        ì´ìŠˆë²ˆí˜¸: issue.ì´ìŠˆë²ˆí˜¸ || (index + 1),
                        ì œëª©: issue.ì œëª© || issue.title || `í˜„ì¬ ì´ìŠˆ ${index + 1}`,
                        ë‚´ìš©: issue.ë‚´ìš© || issue.content || 'ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
                        ì¶”ì¶œì‹œê°„: issue.ì¶”ì¶œì‹œê°„ || issue.crawled_at || new Date().toISOString(),
                        ì¶œì²˜: 'BigKinds ì‹¤ì‹œê°„'
                    }));
                    
                    console.log(`âœ… BigKindsì—ì„œ ${currentIssues.length}ê°œ í˜„ì¬ ì´ìŠˆ ë¡œë“œ ì™„ë£Œ`);
                    
                    // ìƒíƒœ ë°” ì—…ë°ì´íŠ¸
                    updateStatusBar(result.metadata);
                    
                    // ë¡œë”© ìˆ¨ê¸°ê³  ì‹¤ì œ ë°ì´í„° í‘œì‹œ
                    if (loading) loading.style.display = 'none';
                    displayIssues(currentIssues);
                    
                    // ì„±ê³µ ì•Œë¦¼
                    showNotification(`âœ… BigKindsì—ì„œ ${currentIssues.length}ê°œ ì‹¤ì‹œê°„ ì´ìŠˆë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!`, 'success');
                    
                } else {
                    throw new Error('BigKinds API ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('âŒ BigKinds API í˜¸ì¶œ ì‹¤íŒ¨:', error);
                
                // í´ë°±: ë”ë¯¸ ë°ì´í„° ì‚¬ìš©
                currentIssues = [...dummyIssues];
                if (loading) loading.style.display = 'none';
                displayIssues(currentIssues);
                
                // ì—ëŸ¬ ì•Œë¦¼
                showNotification('âš ï¸ ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ì–´ ìƒ˜í”Œ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.', 'warning');
                
                // ìƒíƒœ ë°”ë¥¼ ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì—…ë°ì´íŠ¸
                updateStatusBarOffline();
            }
        }

        // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ì„¤ì •
        function setupRefreshButton() {
            // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ì´ ìˆë‹¤ë©´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const refreshBtn = document.getElementById('refresh-issues-btn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', refreshCurrentIssues);
            }
            
            // ë˜ëŠ” ë™ì ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ìƒì„±
            const statusBar = document.querySelector('.status-bar');
            if (statusBar && !document.getElementById('refresh-issues-btn')) {
                const refreshButton = document.createElement('button');
                refreshButton.id = 'refresh-issues-btn';
                refreshButton.innerHTML = 'ğŸ”„ ì‹¤ì‹œê°„ ìƒˆë¡œê³ ì¹¨';
                refreshButton.style.cssText = `
                    padding: 0.5rem 1rem; 
                    background: #28a745; 
                    color: white; 
                    border: none; 
                    border-radius: 6px; 
                    cursor: pointer;
                    font-size: 0.9rem;
                    margin-left: 1rem;
                    transition: all 0.2s;
                `;
                refreshButton.addEventListener('click', refreshCurrentIssues);
                refreshButton.addEventListener('mouseenter', function() {
                    this.style.background = '#218838';
                });
                refreshButton.addEventListener('mouseleave', function() {
                    this.style.background = '#28a745';
                });
                
                statusBar.appendChild(refreshButton);
            }
        }

        // ì‹¤ì‹œê°„ ìƒˆë¡œê³ ì¹¨ ê¸°ëŠ¥
        async function refreshCurrentIssues() {
            if (isRefreshing) {
                showNotification('âš ï¸ ì´ë¯¸ ìƒˆë¡œê³ ì¹¨ì´ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.', 'warning');
                return;
            }
            
            isRefreshing = true;
            console.log('ğŸ”„ ì‹¤ì‹œê°„ ì´ìŠˆ ìƒˆë¡œê³ ì¹¨ ì‹œì‘');
            
            const refreshBtn = document.getElementById('refresh-issues-btn');
            const originalText = refreshBtn ? refreshBtn.innerHTML : '';
            
            try {
                // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                if (refreshBtn) {
                    refreshBtn.innerHTML = 'â³ í¬ë¡¤ë§ ì¤‘...';
                    refreshBtn.disabled = true;
                    refreshBtn.style.background = '#6c757d';
                }
                
                // 1. ë¨¼ì € ìƒˆë¡œê³ ì¹¨ API í˜¸ì¶œ (ë°±ê·¸ë¼ìš´ë“œ í¬ë¡¤ë§ ì‹œì‘)
                console.log('ğŸ“¡ ìƒˆë¡œê³ ì¹¨ API í˜¸ì¶œ...');
                const refreshResponse = await fetch('/api/refresh-data', { method: 'POST' });
                const refreshResult = await refreshResponse.json();
                
                if (refreshResult.success) {
                    showNotification('ğŸ”„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìƒˆë¡œìš´ í¬ë¡¤ë§ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤...', 'info');
                    
                    // 2. ì ì‹œ ëŒ€ê¸° í›„ ìƒˆë¡œìš´ ë°ì´í„° í™•ì¸
                    setTimeout(async () => {
                        console.log('ğŸ“Š ìƒˆë¡œìš´ ë°ì´í„° í™•ì¸ ì¤‘...');
                        await loadCurrentIssues();
                        
                        // ë²„íŠ¼ ë³µì›
                        if (refreshBtn) {
                            refreshBtn.innerHTML = originalText;
                            refreshBtn.disabled = false;
                            refreshBtn.style.background = '#28a745';
                        }
                        
                        isRefreshing = false;
                        showNotification('âœ… ì‹¤ì‹œê°„ ì´ìŠˆ ì—…ë°ì´íŠ¸ ì™„ë£Œ!', 'success');
                    }, 5000); // 5ì´ˆ í›„ í™•ì¸
                    
                } else {
                    throw new Error('ìƒˆë¡œê³ ì¹¨ API í˜¸ì¶œ ì‹¤íŒ¨');
                }
                
            } catch (error) {
                console.error('âŒ ì‹¤ì‹œê°„ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
                
                // ë²„íŠ¼ ë³µì›
                if (refreshBtn) {
                    refreshBtn.innerHTML = originalText;
                    refreshBtn.disabled = false;
                    refreshBtn.style.background = '#28a745';
                }
                
                isRefreshing = false;
                showNotification('âŒ ì‹¤ì‹œê°„ ìƒˆë¡œê³ ì¹¨ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
            }
        }

        // ìƒíƒœ ë°” ì—…ë°ì´íŠ¸
        function updateStatusBar(metadata) {
            const statusInfo = document.querySelector('.status-info');
            if (statusInfo && metadata) {
                const crawledTime = formatTime(metadata.crawled_at);
                const isSaved = metadata.saved_to_db ? 'ğŸ’¾ DB ì €ì¥ë¨' : '';
                
                statusInfo.innerHTML = `
                    <div class="status-item">
                        <div class="status-indicator" style="background: #28a745; animation: pulse 2s infinite;"></div>
                        <span>BigKinds ì—°ê²°ë¨</span>
                    </div>
                    <div class="status-item">
                        <span>ğŸ“… ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${crawledTime}</span>
                    </div>
                    <div class="status-item">
                        <span>ğŸ“Š ì´ ${metadata.total_issues || currentIssues.length}ê°œ ì´ìŠˆ</span>
                    </div>
                    <div class="status-item">
                        <span>ğŸŒ ì¶œì²˜: ${metadata.source || 'BigKinds'}</span>
                    </div>
                    ${isSaved ? `<div class="status-item"><span>${isSaved}</span></div>` : ''}
                `;
            }
        }

        // ì˜¤í”„ë¼ì¸ ìƒíƒœ ë°” ì—…ë°ì´íŠ¸
        function updateStatusBarOffline() {
            const statusInfo = document.querySelector('.status-info');
            if (statusInfo) {
                statusInfo.innerHTML = `
                    <div class="status-item">
                        <div class="status-indicator" style="background: #ffc107;"></div>
                        <span>ì˜¤í”„ë¼ì¸ ëª¨ë“œ</span>
                    </div>
                    <div class="status-item">
                        <span>ğŸ“… ìƒ˜í”Œ ë°ì´í„° í‘œì‹œ ì¤‘</span>
                    </div>
                    <div class="status-item">
                        <span>ğŸ“Š ì´ ${currentIssues.length}ê°œ ìƒ˜í”Œ ì´ìŠˆ</span>
                    </div>
                    <div class="status-item">
                        <button onclick="loadCurrentIssues()" style="background: #007bff; color: white; border: none; padding: 0.3rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">ğŸ”„ ì¬ì—°ê²° ì‹œë„</button>
                    </div>
                `;
            }
        }

        // ì‹œê°„ í¬ë§·íŒ…
        function formatTime(timeString) {
            if (!timeString) return new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
            
            try {
                const date = new Date(timeString);
                return date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
            } catch (e) {
                return timeString;
            }
        }

        // ì´ìŠˆ í‘œì‹œ
        function displayIssues(issues) {
            const grid = document.getElementById('issues-grid');
            if (!grid) return;
            
            grid.innerHTML = '';

            issues.forEach((issue, index) => {
                const issueCard = document.createElement('div');
                issueCard.className = 'issue-card';
                
                // í¬ë¡¤ë§ ì‹œê°„ í‘œì‹œ
                const timeInfo = issue.ì¶”ì¶œì‹œê°„ ? formatCrawlTime(issue.ì¶”ì¶œì‹œê°„) : '';
                
                issueCard.innerHTML = `
                    <div class="issue-header">
                        <div class="issue-number">#${issue.ì´ìŠˆë²ˆí˜¸}</div>
                        ${timeInfo ? `<div class="issue-time" style="font-size: 0.7rem; color: #666;">${timeInfo}</div>` : ''}
                    </div>
                    <div class="issue-title">${issue.ì œëª©}</div>
                    <div class="issue-content">${issue.ë‚´ìš©}</div>
                    <div class="issue-footer">
                        <button class="analyze-btn" onclick="analyzeIssue(${issue.ì´ìŠˆë²ˆí˜¸}, '${escapeQuotes(issue.ì œëª©)}')">
                            ğŸ” ë¶„ì„í•˜ê¸°
                        </button>
                        <button class="bookmark-btn" onclick="bookmarkIssue(${issue.ì´ìŠˆë²ˆí˜¸})" style="background: #ffc107; color: #333; margin-left: 0.5rem;">
                            â­ ì €ì¥
                        </button>
                    </div>
                `;
                grid.appendChild(issueCard);
            });
            
            console.log(`ğŸ¨ ${issues.length}ê°œ ì´ìŠˆ ì¹´ë“œ ë Œë”ë§ ì™„ë£Œ`);
        }

        // í¬ë¡¤ë§ ì‹œê°„ í¬ë§·íŒ…
        function formatCrawlTime(timeString) {
            try {
                const date = new Date(timeString);
                const now = new Date();
                const diffMinutes = Math.floor((now - date) / (1000 * 60));
                
                if (diffMinutes < 1) return 'ë°©ê¸ˆ ì „';
                if (diffMinutes < 60) return `${diffMinutes}ë¶„ ì „`;
                if (diffMinutes < 1440) return `${Math.floor(diffMinutes / 60)}ì‹œê°„ ì „`;
                return date.toLocaleDateString('ko-KR');
            } catch (e) {
                return '';
            }
        }

        // ë”°ì˜´í‘œ ì´ìŠ¤ì¼€ì´í”„
        function escapeQuotes(str) {
            return str.replace(/'/g, "\\'").replace(/"/g, '\\"');
        }

        // ì´ìŠˆ ì¦ê²¨ì°¾ê¸°
        function bookmarkIssue(issueNumber) {
            const issue = currentIssues.find(i => i.ì´ìŠˆë²ˆí˜¸ === issueNumber);
            
            if (!issue) {
                showNotification('âš ï¸ ì„ íƒí•œ ì´ìŠˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            try {
                const bookmarks = JSON.parse(localStorage.getItem('orda_current_bookmarks') || '[]');
                const bookmark = {
                    id: `current_${issueNumber}`,
                    title: issue.ì œëª©,
                    content: issue.ë‚´ìš©,
                    crawled_at: issue.ì¶”ì¶œì‹œê°„,
                    saved_at: new Date().toISOString()
                };
                
                const existingIndex = bookmarks.findIndex(b => b.id === bookmark.id);
                if (existingIndex === -1) {
                    bookmarks.push(bookmark);
                    localStorage.setItem('orda_current_bookmarks', JSON.stringify(bookmarks));
                    showNotification(`â­ "${issue.ì œëª©}"ì„(ë¥¼) ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€í–ˆìŠµë‹ˆë‹¤!`, 'success');
                } else {
                    showNotification('ì´ë¯¸ ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€ëœ ì´ìŠˆì…ë‹ˆë‹¤.', 'warning');
                }
            } catch (e) {
                showNotification('ì¦ê²¨ì°¾ê¸° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showNotification(message, type = 'info') {
            const colors = {
                success: '#4CAF50',
                warning: '#ff9800', 
                error: '#f44336',
                info: '#2196F3'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; 
                top: 20px; 
                right: 20px; 
                background: ${colors[type] || colors.info}; 
                color: white; 
                padding: 15px 20px; 
                border-radius: 8px; 
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 1000;
                font-weight: 500;
                max-width: 400px;
                animation: slideIn 0.3s ease;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; color: white; font-size: 18px; cursor: pointer;">Ã—</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // 5ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // ì´ìŠˆ ë¶„ì„ ì‹œì‘
       // ì´ìŠˆ ë¶„ì„ ì‹œì‘
        function analyzeIssue(issueId, title) {
            console.log(`ğŸ” í˜„ì¬ ì´ìŠˆ ë¶„ì„ ì‹œì‘: ${issueId} - ${title}`);

            const issue = currentIssues.find(i => i.ì´ìŠˆë²ˆí˜¸ === issueId);

            if (!issue) {
                showNotification('âš ï¸ ì„ íƒí•œ ì´ìŠˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            showNotification(`ğŸ” "${title}" ì´ìŠˆ ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤...`, 'info');
            showAnalysisModal(issue);  // âœ… ì‹¤ì œ ëª¨ë‹¬ ì—´ê¸°
        }

        
// ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜
function showAnalysisModal(issue) {
    const modal = document.getElementById('analysis-modal');
    document.getElementById('modal-title').textContent = issue.ì œëª©;
    document.getElementById('modal-content').textContent = issue.ë‚´ìš©;

    const industryMap = {
        1: [{ name: 'ë°©ìœ„ì‚°ì—…', reason: 'ì¤‘ë™ ì „ìŸ ê°€ëŠ¥ì„±ê³¼ êµ°ìˆ˜ì£¼ í™•ëŒ€ ê¸°ëŒ€ ë•Œë¬¸ì…ë‹ˆë‹¤.' }],
        2: [{ name: 'ë°˜ë„ì²´ ì¥ë¹„', reason: 'ë‚˜ë…¸ ê¸°ìˆ  ë°œí‘œê°€ ë°˜ë„ì²´ ê³µì • í˜ì‹ ê³¼ ì—°ê²°ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.' }],
        3: [{ name: 'í™˜ê²½í”ŒëœíŠ¸', reason: 'ìƒëª© ì§€ì—­ì˜ ì¹œí™˜ê²½ ì •ì±… í™•ëŒ€ì— ë”°ë¼ ê´€ë ¨ ì—…ì¢… ì£¼ëª©' }]
    };

    const pastIssueMap = {
        1: [{ title: '2020ë…„ ì´ë€-ë¯¸êµ­ ë¬´ë ¥ì¶©ëŒ', reason: 'ì¤‘ë™ ê°ˆë“±ì´ ë°©ì‚°ì£¼ ìƒìŠ¹ì„ ì´ëŒì—ˆìŠµë‹ˆë‹¤.' }],
        2: [{ title: '2019ë…„ ë°˜ë„ì²´ ë¯¸ì„¸ê³µì • ê¸°ìˆ  ë°œí‘œ', reason: 'ê¸°ìˆ  ë°œí‘œ í›„ ê´€ë ¨ ì¥ë¹„ ê¸°ì—… ì£¼ê°€ ìƒìŠ¹' }],
        3: [{ title: '2021ë…„ íƒ„ì†Œì¤‘ë¦½ ì„ ì–¸', reason: 'í™˜ê²½ì •ì±… í™•ëŒ€ ë°œí‘œê°€ í™˜ê²½ì‚°ì—… ì£¼ê°€ì— ê¸ì •ì  ì˜í–¥' }]
    };

    const industryList = document.getElementById('modal-industries');
    industryList.innerHTML = '';
    (industryMap[issue.ì´ìŠˆë²ˆí˜¸] || []).forEach(ind => {
        const li = document.createElement('li');
        li.innerHTML = `
            <strong>${ind.name}</strong>
            <div style="margin-top:4px; background:#f8f9fa; padding:8px 12px; border-radius:8px; color:#333; font-size:0.9rem;">
                ${ind.reason}
            </div>
        `;
        industryList.appendChild(li);
    });

    const pastList = document.getElementById('modal-past-issues');
    pastList.innerHTML = '';
    (pastIssueMap[issue.ì´ìŠˆë²ˆí˜¸] || []).forEach(past => {
        const li = document.createElement('li');
        li.innerHTML = `
            <strong>${past.title}</strong>
            <div style="margin-top:4px; background:#f1f3f5; padding:8px 12px; border-radius:8px; color:#333; font-size:0.9rem;">
                ${past.reason}
            </div>
        `;
        pastList.appendChild(li);
    });

    modal.style.display = 'flex';
}

function closeAnalysisModal() {
    const modal = document.getElementById('analysis-modal');
    modal.style.display = 'none';
}


// í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜
        function navigateTo(page) {
            const pages = {
                'home': '/static/index.html',
                'news': '/static/news.html', 
                'sector': '/static/sector.html',
                'company': '/static/company.html',
                'mock-invest': '/static/mock-invest.html'
            };
            
            if (page !== 'home') {
                console.log(`ğŸ§­ í˜ì´ì§€ ì´ë™: ${page}`);
                window.location.href = pages[page];
            }
        }

        // CSS ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            @keyframes pulse {
                0% { opacity: 1; }
                50% { opacity: 0.5; }
                100% { opacity: 1; }
            }
            
            .status-indicator {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                display: inline-block;
                margin-right: 0.5rem;
            }
            
            .issue-card {
                transition: all 0.2s ease;
            }
            
            .issue-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            }
            
            .analyze-btn, .bookmark-btn {
                transition: all 0.2s ease;
            }
            
            .analyze-btn:hover {
                background: #ff5252 !important;
            }
            
            .bookmark-btn:hover {
                background: #ffb300 !important;
            }
        `;
        document.head.appendChild(style);

        // ê°œë°œì ë„êµ¬ì—ì„œ ìˆ˜ë™ í…ŒìŠ¤íŠ¸ìš© í•¨ìˆ˜ë“¤
        window.debugOrdaAPI = {
            loadIssues: loadCurrentIssues,
            refreshIssues: refreshCurrentIssues,
            currentIssues: () => currentIssues,
            testAPI: async () => {
                const response = await fetch('/api/health');
                return await response.json();
            },
            testTodayIssues: async () => {
                const response = await fetch('/api/today-issues');
                return await response.json();
            }
        };
        
        console.log('ğŸ¯ ì˜¤ë¥´ë‹¤ HOME í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ (BigKinds í¬ë¡¤ë§ ì—°ë™)');
        console.log('ğŸ’¡ ê°œë°œì ë„êµ¬ì—ì„œ window.debugOrdaAPIë¡œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥');
</script>

<!-- ë¶„ì„ ëª¨ë‹¬ -->
<div id="analysis-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:2000; justify-content:center; align-items:center;">
  <div style="background:white; padding:2rem; border-radius:12px; max-width:800px; width:90%; max-height:90%; overflow-y:auto; position:relative;">
    <button onclick="closeAnalysisModal()" style="position:absolute; top:10px; right:15px; font-size:18px; background:none; border:none; cursor:pointer;">âœ–</button>
    <h2 style="margin-bottom:1rem;" id="modal-title">ì´ìŠˆ ì œëª©</h2>
    <p style="color:#555; margin-bottom:1.5rem;" id="modal-content">ì´ìŠˆ ë‚´ìš©</p>

    <h3>ğŸ“Œ ê´€ë ¨ ì‚°ì—…</h3>
    <ul id="modal-industries" style="margin-bottom:1.5rem;"></ul>

    <h3>ğŸ“š ê³¼ê±° ìœ ì‚¬ ì´ìŠˆ</h3>
    <ul id="modal-past-issues"></ul>
  </div>
</div>

</body>
</html>